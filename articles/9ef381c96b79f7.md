---
title: "新築マイホームに UniFi を導入して天井 AP 設置 & 10Gbps Ethernet で構築してみた"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["network", "ネットワーク", "UniFi", "Ubiquiti", "家庭内ネットワーク構築"]
published: false
---

タイトル通り 2022年12月 に新築のマイホームを建てまして、その際に UniFi を導入して天井 AP を設置し、10Gbps に対応したネットワークを構築しました。

## ことの発端

私は東海地方に居を構えており、賃貸の頃からインターネット回線はコミュファ光を使用しています。

そのコミュファ光が 10Gbps のサービスを提供しているので乗っかかったはいいものを、当時は一般的な 1Gbps 対応の機材しか持っていませんでした。

せっかく 10Gbps の回線を引いているのなら機材や PC も 10Gbps に対応させてその恩恵を享受したいですよね。

そんな中、いろいろなイベントを経てマイホーム計画が立ち上がったわけです。

「マイホームに 10Gbps Ethernet を構築するしかない…」と

## UniFi との出会い

さて、10Gbps 化すると決まったわけですがこの要件であれば家庭向け無線 LAN ルーターでも対応できる機種が出ているのでそれで充分でしょう。

今回のネットワークの構築にあたっては実は以下の要件を掲げていました。

1. WAN、LAN 共に 10Gbps に対応するポートを備えていること。
2. 天井にアクセスポイント（AP）を設置できること。
メッシュに対応していると嬉しい。
3. 設定はコントローラーとなる機器ですべての機器を一元管理できること。
クラウド経由で設定ができると嬉しい。
4. IPv6 に対応していること。
5. ファンレスであること。
6. コスパが良いこと。（重要）

これは本職でオフィスのネットワークの構築・運用をするにあたって天井 AP を触ってきたこと、Cisco Meraki を代表としたクラウド管理型の製品を触ってきたことにより管理運用の手軽さを知っていたからです。

そんな中、以下の記事を見つけ UniFi の存在を知りました。

https://www.kzk9.net/post/202008_unifi/

記事にもある通り、コスパがめちゃくちゃいいネットワーク機器みたいです。

Meraki や Mist のようにクラウド管理ができる上にそれらと違ってライセンス費用がかからないのが特徴のようで、コスパを重視していたのでこの時点で脳内検討リストの上位に食い込んでいました。

[公式オンラインストア](https://jp.store.ui.com/) で機種のラインナップを見てみると以下の機種を見つけました。

| カテゴリー | 機種名 | 特徴 |
| ---- | ---- | ---- |
| ルーター | Dream Machine Pro | ・最大 10Gbps に対応した WAN ポートを備えている <br> ・最大 10Gbps に対応した LAN ポートを備えている <br> ・ファンレス |
| AP | Access Point U6 Pro | ・天井や壁面マウントに対応 |
| スイッチ 1 | Switch Pro 24 PoE | ・PoE++ に対応しており Access Point U6 Pro に対して給電できる <br> ・最大 10Gbps に対応した SFP ポートを 2つ 備えている <br> ・ファンレス |
| スイッチ 2 | Switch Aggregation | ・最大 10Gbps に対応した SFP ポートを 8つ 備えている <br> ・ファンレス |

この通り、要件に掲げていた IPv6 対応以外をカバーしている事がわかり、UniFi を採用することに決定しました。

## 構成

最終的には以下のような構成になりました。

私のこだわりもあり、人が過ごす場所すべてに有線を敷設しています。

こう見ると、10Gbps に対応しているのはごく一部ですが敷設している LAN ケーブルはすべて CAT6A に統一しているので必要あればいつでも 10Gbps 化が可能です。

![最終的な構成図](https://storage.googleapis.com/zenn-user-upload/28804bb6a690-20221221.png)

## 設定

UniFi 機器の設定は至ってシンプルです。

UniFi OS を搭載している Dream Machine Pro の電源を入れて LAN ポートにクライアントを接続します。

DHCP で IP アドレスとともにデフォルトゲートウェイ（Dream Machine Pro）の IP アドレスが降ってくるので、その IP アドレスに接続します。

初期設定のガイダンスの通りに進めると [UI アカウント](https://account.ui.com/) のサインインを求められます。

アカウントの連携が終わるとクラウド管理が有効になり、以降は UniFi のクラウドコンソール( https://unifi.ui.com/dashboard )から UniFi 機器の管理が可能になります。

![UniFi コンソール](https://storage.googleapis.com/zenn-user-upload/f0a2a5f6787c-20221221.png)

### ① Dream Machine Pro（ルーター）

まず真っ先に Dream Machine Pro を購入して IPv6 に対応しているかどうかを調査しました。

事前に調査した範囲では NTT 系の IPv4 over IPv6 環境は対応していないことがわかっていたので、コミュファ光が採用しているデュアルスタック方式では使用できるのかの検証を行いました。（ここで思うようにいかなければ、本製品の採用はやめてメルカリ行きを考えていました…）

IPv6 の設定をするに当たり、以下の HP や資料を参考にしました。

https://mupon.net/isp-vne-ipv6-ipoe/

[ctc IPv6接続サービス ～ 提供開始後のあれこれ ～](https://www.jaipa.or.jp/event/isp_mtg/nagoya/150313_mizuno.pdf)

初期設定ではポート 9（1Gbps※）がデフォルト WAN に設定されているので、一旦 WAN を ポート9 に接続します。

※ 後発の Dream Machine SE では 2.5Gbps のようです。

UniFi の Network 設定 → Internet → Default WAN の順にたどると、WAN の設定画面になります。ここで最下部の IPv6 の設定を以下のように変更します。

| 項目名 | 設定値 |
| ---- | ---- |
| IPv6 Connection | DHCPv6 |
| Prefix Delegation Size | 56 |

![UniFi での IPv6 設定](https://storage.googleapis.com/zenn-user-upload/010f9f09e254-20221221.png)

これらの設定変更によりコミュファ光の回線でクライアントに対して IPv6 を配布することが確認できました。

https://test-ipv6.com/index.html.ja_JP

![IPv6 の接続確認](https://storage.googleapis.com/zenn-user-upload/47efffdad503-20221221.png)

これで求めていた要件をすべて満たすことがわかりました。もう怖いものなしです。他の機材も購入してどんどん設定していきます。

ただし、このままではデフォルトの WAN が性能の低いポート 9 のままのため、10Gbps に対応できるポート 10 に変更します。

UniFi の Network 設定 → Internet の順にたどった設定画面で変更できます。

![デフォルト WAN のポートの変更](https://storage.googleapis.com/zenn-user-upload/c19e3754c3c3-20221221.png)

### ② Switch Pro 24 PoE・Switch Aggregation（スイッチ）

スイッチを設定します。Dream Machine Pro の LAN に接続することで、Dream Machine Pro の設定画面で自動で認識されます。

認識するとネットワークに追加するかの確認を求められるので、それを許諾することで Dream Machine Pro の管理下に入ります。

スイッチの設定は主にポートの挙動の設定ができます。VLAN などの設定は Dream Machine Pro で予め設定しておけば自動で追従されます。

![スイッチのポートの設定](https://storage.googleapis.com/zenn-user-upload/c416ef1e2bb4-20221221.png)

この画面では PoE の ON/OFF の他にリンクアグリゲーションやミラーリングに関する設定が可能です。

:::message alert
リンクアグリゲーションは UniFi のスイッチ製品のみ対応しています。Dream Machine Pro は対応していないので注意が必要です。
私の環境では、上流が非対応のためすべての機材間はリンクアグリゲーションなしで運用しています。
:::

### ③ Access Point U6 Pro（AP）

AP もスイッチと同様に  Dream Machine Pro の LAN に接続することで管理下に置くことができます。

Dream Machine Pro で設定した WiFi の設定が管理下の AP に配布されます。

私の環境ではすべての AP に同じ設定を配布していますが、AP ごとにグループを作ってグループ単位で設定を配布することも可能です。

## 設置

### AP

### ルーター・スイッチ類
