---
title: "Microsoft Intune で使える MSI インストーラを Web から取得＆展開できるスクリプトを作った"
emoji: "📘"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Intune", "PowerShell", "Windows"]
published: false
---

## これは何？

Intune ではアプリケーションの展開において、MSI インストーラ形式で配布されているアプリケーションを管理デバイスに展開することができます。

今回、運用のやりやすさを上げるために実施した取り組みをここにまとめます。

## 課題1：アプリケーションのバージョンが上がるたびに配布パッケージを Intune に登録する必要がある

これは Intune に限らず MDM 関連ではあるあるな話ですが、アプリケーションの配布において MDM にインストーラを直接アップロードするとデバイスに配布されるアプリケーションのバージョンが固定化されてしまう課題があります。

アプリケーションによっては自動でアップデートされるにしても、バージョンが古くなったものを配布することはわずかながらもセキュリティのリスクを伴います。

これを解決するにはアプリケーションのバージョンが上がった際には都度 MDM にアップロードする必要があります。が、Intune においてはアップロードファイル（`.intunewin`ファイルとか）を用意するのは手間ですよね……。

## 課題2：「Windows アプリ（Win32）」と「基幹業務アプリ」が同時利用できない

これは Intune の罠なポイントと個人的には思っているのですが、Intune では「Windows アプリ（Win32）」形式でアプリケーションを配布する場合、同じタイミングに別形式（基幹業務アプリなど）を使ったアプリケーションを配布することは非推奨とされています。

@[card](https://learn.microsoft.com/ja-jp/mem/intune/apps/apps-win32-troubleshoot)

> Win32 アプリを展開する場合、特に複数ファイルの Win32 アプリ インストーラーがある場合は、Intune 管理拡張機能の方法を排他的に使用することを検討してください。 Autopilot 登録中に Win32 アプリと基幹業務 (LOB) アプリのインストールを混在させる場合、アプリのインストールが失敗する可能性があります。

これ個人的にはインストールの排他処理が正しく行われないのではと思っているのですが、AutoPilot などデバイスのセットアップにて多量のインストール処理をさせたいケースでこの仕様が顕著に影響してしまいます。

つまり回避するには MSI 形式のインストーラでも「Windows アプリ（Win32）」で作成する必要があるわけです。しかし、それだと課題1の`.intunewin`ファイルの作成のめんどくさいところが都度発生します。

## 本スクリプトでできること

この記事で紹介するスクリプトは以下の機能を有します。

- 指定した URL から MSI インストーラを自動取得＆インストール
- アンインストール

## 事前準備で必要な情報

本スクリプトを使う場合は以下の情報が予め必要です。

### MSI インストーラーの公開 URL

導入したいアプリケーションの MSI インストーラーの配布先です。
本スクリプトはこの URL からダウンロード、インストールを実行します。

この URL は気合いで探す必要がありますが、私が調査したものをいくつか紹介します。

|アプリケーション|配布 URL|
|----|----|
|Google Chrome (64bit番)|```https://dl.google.com/dl/chrome/install/googlechromestandaloneenterprise64.msi```|
|Zoom (64bit番)|```https://zoom.us/client/latest/ZoomInstallerFull.msi?archType=x64```|
