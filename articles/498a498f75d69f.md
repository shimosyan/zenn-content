---
title: "【Jamf Pro】macOS のテーマに応じて DepNotify に表示させる画像を切り替える"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["mac", "apple", "jamf"]
published: false
---

## はじめに

Jamf Pro で Prestage Enrollment を使って macOS のキッティングをする際、ユーザー体験向上の目的として [DepNotify](https://github.com/jamf/DEPNotify-Starter) を使うことがあると思います。

この DepNotify、会社のロゴなど好きな画像を1枚表示させることができるのですが、例えば黒メインの画像の場合では自然な見た目になりますがダークモードでは背景と紛れてしまい見た目が悪くなることがあります。

今回はこの画像を macOS のテーマによって異なる画像を表示させる Tips となります。

## DepNotify とはなんぞやって人は？

こちらを参考してくだい。

- [【Jamf】DEPNotifyを使ってゼロタッチデプロイメントっぽいことしてみる。](https://qiita.com/soh19/items/b28537a71e46038934a8)
- [くらめその情シス：jamfPROにDEP Notifyを使用してMacの自動セットアップを構成してみた](https://dev.classmethod.jp/articles/jamf_dep-notify_configuration/)

## 前提条件

本記事は以下のバージョンを使用しています。

- DepNotify.app `1.1.6`
- DepNotify.sh  `2.0.7`

## 作業前の準備

Mac に配布する DepNotify 用の画像がライトモード用とダークモード用の2ファイル必要になります。

Composer アプリを使った `.pkg` ファイルの用意は各自で行ってください。

## 設定方法

ライトモード用の画像は通常通り `DepNotify.sh` 50行目辺りにある `BANNER_IMAGE_PATH` にファイルパスを指定してください。

```sh:DepNotify.sh
# Banner image can be 600px wide by 100px high. Images will be scaled to fit
# If this variable is left blank, the generic image will appear. If using custom Self
# Service branding, please see the Customized Self Service Branding area below
  BANNER_IMAGE_PATH="ライトモード用画像のファイルパス"
```

ダークモード用の画像は、`DepNotify.sh` の 500 行目くらいにある `# After the Apple Setup completed. Now safe to grab the current user and user ID` が書かれているコードセクションの後ろに以下のようにコードを追加してください。

```sh:DepNotify.sh
# After the Apple Setup completed. Now safe to grab the current user and user ID
  CURRENT_USER=$(/usr/bin/stat -f "%Su" /dev/console)
  CURRENT_USER_ID=$(id -u $CURRENT_USER)
  echo "$(date "+%a %h %d %H:%M:%S"): Current user set to $CURRENT_USER (id: $CURRENT_USER_ID)." >> "$DEP_NOTIFY_DEBUG"

# ダークモードの場合は、画像を差し替える
  if [ -n "$CURRENT_USER" ]; then
    OS_THEME_CONFIG_FILE="/Users/$CURRENT_USER/Library/Preferences/.GlobalPreferences.plist"
    OS_THEME=$(/usr/libexec/PlistBuddy -c 'print :AppleInterfaceStyle' ${OS_THEME_CONFIG_FILE})
    if [ "$OS_THEME" = "Dark" ]; then
      # for Dark mode.
      echo "$(date "+%a %h %d %H:%M:%S"): Enable Dark mode." >> "$DEP_NOTIFY_DEBUG"
      BANNER_IMAGE_PATH="ダークモード用画像のファイルパス"
    fi
  fi

# Stop DEPNotify if there was already a DEPNotify window running (from a PreStage package postinstall script).
```
