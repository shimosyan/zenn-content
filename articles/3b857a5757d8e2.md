---
title: "Windows ã§æœ€æ–°ã® Okta Verify ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸï¼ˆIntuneã®åˆ©ç”¨ã‚’æƒ³å®šï¼‰"
emoji: "ğŸ“²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Intune", "PowerShell", "Windows", "Okta"]
published: true
---

## ã“ã‚Œã¯ä½•ï¼Ÿ

Microsoft Intune ã«ã¦ä»»æ„ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã›ãšã«æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å±•é–‹ã™ã‚‹æ–¹æ³•ã®æ´¾ç”Ÿè¨˜äº‹ã§ã™ã€‚

@[card](https://zenn.dev/shimosyan/articles/2f34f66d1d5b9a)

ã“ã“ã§ã¯ iDaaS ã® Okta ã§ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—èªè¨¼ã‚„ç”Ÿä½“èªè¨¼ã§åˆ©ç”¨ã§ãã‚‹ã€ŒOkta Verifyã€ã‚’ Intune ã¸ã®å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸è¦ã§å¸¸ã«æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å±•é–‹ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## Intuneå‘¨ã‚Šã®è¨­å®šæ–¹æ³•ã«ã¤ã„ã¦

ã“ã“ã¨åŒã˜ãªã®ã§é‡è¤‡ã™ã‚‹ã¨ã“ã‚ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚

@[card](https://zenn.dev/shimosyan/articles/2f34f66d1d5b9a)

## å®Ÿç¾ã™ã‚‹ä»•çµ„ã¿ã«ã¤ã„ã¦

Windows ç”¨ã® Okta Verify ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã¯ Okta ã®ç®¡ç†ç”»é¢ã§ã®ã¿å…¥æ‰‹å¯èƒ½ã§ã€ãã‚Œä»¥å¤–ï¼ˆMicrosoft Store ã‚„ winget ã‚³ãƒãƒ³ãƒ‰ï¼‰ã®æ–¹æ³•ã§ã¯å…¥æ‰‹ã§ãã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€å®Ÿã¯Oktaç®¡ç†ç”»é¢ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã‚‹é…å¸ƒURLã¯èªè¨¼ãªã—ã§èª°ã§ã‚‚å…¥æ‰‹ã§ãã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®ä»•çµ„ã¿ã‚’ä½¿ã£ã¦ Windows ç«¯æœ«å®Ÿæ©Ÿã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å–å¾—ã—ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

16è¡Œç›®ã§ `$url` ã®å¤‰æ•°å®šç¾©ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ `<YOUR_ORGANIZATION>` ã®ç®‡æ‰€ã ã‘ãŠä½¿ã„ã® Okta ãƒ†ãƒŠãƒ³ãƒˆã«åˆã‚ã›ã¦ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `oktaVerifyInstall.ps1` ã¨ã—ã¾ã™ã€‚

```powershell
#
# Ref
# https://help.okta.com/oie/ja-jp/content/topics/identity-engine/devices/ov-install-options-windows.htm
# https://help.okta.com/oie/ja-jp/content/topics/identity-engine/devices/ov-win-config-vdi.htm
#
param(
  [string]$oktaUrl = "",
  [switch]$windows365 = $false,
  [switch]$awsworkspaces = $false,
  [switch]$uninstall = $false,
  [switch]$isDebug = $false
)

$installer = "OktaVerifySetup.exe"
$label = "OktaVerify"
$url = "https://<YOUR_ORGANIZATION>-admin.okta.com/api/v1/artifacts/WINDOWS_OKTA_VERIFY/download?releaseChannel=GA"
$testPath = "C:\Program Files\Okta\Okta Verify\OktaVerify.exe"
$maxWaitTime = 120

function checkInstallPath($exist) {
	for($i = 0; $i -lt $maxWaitTime; $i++){
    if((Test-Path $testPath) -eq $exist){
      # break ã§ãƒ«ãƒ¼ãƒ—ã‚’çµ‚äº†ã—ã¾ã™ã€‚
      break
    }

    Start-Sleep -Seconds 1
  }

  # 30ç§’ã»ã©å¾…æ©Ÿã„ã‚Œãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
  Start-Sleep -Seconds 30
}

If($windows365 -and $awsworkspaces){
  echo "-windows365 ã¨ -awsworkspaces ã¯åŒæ™‚ã«æŒ‡å®šã§ãã¾ã›ã‚“ã€‚"
  exit 1
}

if (!$isDebug){
  $ProgressPreference = "SilentlyContinue"
}

if ($uninstall)
{
  $productId32bit = (Get-ChildItem -Path "Registry::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" | Get-ItemProperty | Where-Object DisplayName -like "$label*" | Select-Object -ExpandProperty PSChildName)
  $productId64bit = (Get-ChildItem -Path "Registry::HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall" | Get-ItemProperty | Where-Object DisplayName -like "$label*" | Select-Object -ExpandProperty PSChildName)

  if ($productId32bit -eq "" -and $productId64bit -eq ""){
    echo "ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
    exit 1
  }

  $productId = ""
  if (!($productId32bit -ne "" -or $productId64bit -ne "")){
    echo "32bit ã¨ 64bit ä¸¡æ–¹ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚64bit ã‚’å„ªå…ˆã—ã¾ã™ã€‚"
    $productId = $productId64bit
  }else{
    $productId = (echo $productId32bit$productId64bit)
  }

  Start-Process -FilePath "msiexec" -ArgumentList "/x", $productId, "/qn"

  # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’èµ·å‹•ã™ã‚‹ã¨éåŒæœŸã§å‡¦ç†ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã‚ˆã‚Šã‚‚å…ˆã«æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Œäº†ã—ã¦ã—ã¾ã†æã‚ŒãŒã‚ã‚‹
  # å…ˆã«çµ‚äº†ã—ã¦ã—ã¾ã†ã¨ Intune ã®å®Œäº†æ¤œçŸ¥ã«ã¦èª¤ä½œå‹•ã‚’èµ·ã“ã—ã¦ã—ã¾ã†ãŸã‚ä¸€å®šæ™‚é–“ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹
  checkInstallPath $false

  exit 0
}

Invoke-WebRequest -UseBasicParsing -Uri $url -OutFile $installer

if($windows365){
  Start-Process -FilePath ".\$installer" -ArgumentList "/q", "OrgUrl=$oktaUrl", "AuthenticatorOperationMode=VirtualDesktopStatic"
}elseif($awsworkspaces){
  Start-Process -FilePath ".\$installer" -ArgumentList "/q", "OrgUrl=$oktaUrl", "AuthenticatorOperationMode=VirtualDesktopLayered"
}else{
  Start-Process -FilePath ".\$installer" -ArgumentList "/q", "OrgUrl=$oktaUrl"
}

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’èµ·å‹•ã™ã‚‹ã¨éåŒæœŸã§å‡¦ç†ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã‚ˆã‚Šã‚‚å…ˆã«æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Œäº†ã—ã¦ã—ã¾ã†æã‚ŒãŒã‚ã‚‹
# å…ˆã«çµ‚äº†ã—ã¦ã—ã¾ã†ã¨ Intune ã®å®Œäº†æ¤œçŸ¥ã«ã¦èª¤ä½œå‹•ã‚’èµ·ã“ã—ã¦ã—ã¾ã†ãŸã‚ä¸€å®šæ™‚é–“ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹
checkInstallPath $true

```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‘¼ã³å‡ºã—æ–¹æ³•

å±•é–‹ã™ã‚‹ç’°å¢ƒã«ã‚ˆã£ã¦ç•°ãªã‚‹ã®ã§ä»¥ä¸‹ã®è¡¨ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

`<YOUR_ORGANIZATION>` ã¯ãŠä½¿ã„ã® Okta ãƒ†ãƒŠãƒ³ãƒˆã«åˆã‚ã›ã¦ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚

|å±•é–‹å…ˆãƒ»ç”¨é€”|å‘¼ã³å‡ºã—ã‚³ãƒãƒ³ãƒ‰|
|---|---|
|Windows å®Ÿæ©Ÿã¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«|`powershell -ExecutionPolicy Bypass -windowstyle hidden ".\oktaVerifyInstall.ps1 https://<YOUR_ORGANIZATION>.okta.com"`|
|Microsoft365 ä»®æƒ³ç’°å¢ƒã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«|`powershell -ExecutionPolicy Bypass -windowstyle hidden ".\oktaVerifyInstall.ps1 https://<YOUR_ORGANIZATION>.okta.com -windows365"`|
|AWS Workspace ä»®æƒ³ç’°å¢ƒã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«|`powershell -ExecutionPolicy Bypass -windowstyle hidden ".\oktaVerifyInstall.ps1 https://<YOUR_ORGANIZATION>.okta.com -awsworkspaces"`|
|ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«|`powershell -ExecutionPolicy Bypass -windowstyle hidden ".\oktaVerifyInstall.ps1 -uninstall"`|
